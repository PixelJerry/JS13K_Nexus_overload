<!DOCTYPE html><html><head><meta charset="utf-8"><title>Nexus overload</title><style>#menu,#stage,body{background:#181818}#container,#menuHead{width:100%;position:absolute}#container,#menu,#menuHead,#stage,.footer,.menuButtons{position:absolute}body,html{margin:0;padding:0;overflow:hidden;font-family:Consolas,monaco,monospace;font-weight:400;text-align:left;cursor:default}#menuHead,.lvlData,.menuButton{text-align:center}body{min-height:100vh;min-width:100%}#container{top:0;left:0;height:100vh}#menu,#stage{top:0;left:0;width:1500px;height:1080px;transition:background .5s;-webkit-transition:background .5s;-moz-transition:background .5s}#menu{transition:opacity .5s,visibility .5s;-webkit-transition:opacity .5s,visibility .5s;-moz-transition:opacity .5s,visibility .5s;visibility:hidden;opacity:0}.mapNode,.menuButton{transition:background .25s}#menu.show{visibility:visible;opacity:1}#menuHead{top:80px;height:100px;line-height:170px;font-size:170px;color:#FFF}.menuButtons{top:350px;left:calc(50% - 365px);width:730px;min-height:100px}.menuButton{margin:0 0 40px;display:block;width:730px;height:140px;line-height:90px;font-size:80px;color:#FFF;-webkit-transition:background .25s;-moz-transition:background .25s}.menuButtonSubText{line-height:50px;font-size:20px;color:grey;text-align:center}.endData{width:730px;height:360px}.footer,.lvlData{height:100px;font-size:35px}.lvlData{width:730px;margin:0 0 20px;line-height:40px}.btnGreen{box-shadow:0 0 0 4px #24FF96}.btnBlue{box-shadow:0 0 0 4px #3EFFEC}.btnOrange{box-shadow:0 0 0 4px #FF945F}.btnRed{box-shadow:0 0 0 4px #FF5C87}.btnDarkGrey{box-shadow:0 0 0 4px #282828}.btnGrey{box-shadow:0 0 0 4px grey}.btnWhite{box-shadow:0 0 0 4px #FFF}.txtGreen{color:#24FF96}.txtBlue{color:#3EFFEC}.txtOrange{color:#FF945F}.txtRed{color:#FF5C87}.txtWhite{color:#FFF}.fillGreen{background:#24FF96}.fillWhite{background:#FFF}.menuButton.btnGreen:hover{background:rgba(0,86,39,1)}.menuButton.btnBlue:hover{background:rgba(0,66,56,1)}.menuButton.btnOrange:hover{background:rgba(107,38,0,1)}.mapNode.btnGrey.next:hover{background:rgba(128,128,128,1)}.lastMapNode.btnRed.next:hover{background:rgba(255,92,135,1)}.mapNode.btnBlue.next:hover{background:rgba(62,255,236,1)}.mapNode.btnOrange.next:hover{background:rgba(255,148,95,1)}.footer{top:950px;width:100%;line-height:35px;color:#FF5C87;text-align:center}#endHead,#endStats,#mapLayer,.ugHead{width:700px;left:calc(50% - 350px);position:absolute;text-align:center}#map,#mapLines{position:absolute;top:460px;left:calc(50% - 365px);width:730px;height:400px}#endHead,#mapLayer,.ugHead{top:300px;font-size:30px}#endStats{top:380px;font-size:25px;line-height:40px}.ugHead{top:290px}#mapLegend{position:absolute;top:380px;left:calc(50% - 350px);width:730px;height:40px}.legendBlock,.legendText{height:30px;vertical-align:middle;line-height:30px;display:inline-block}.legendBlock{width:30px;font-size:20px;text-align:center;left:0;margin:0 10px 0 0}.legendText{width:125px;font-size:18px;margin:0}.legendText:last-child{position:absolute;top:40px;left:0;width:700px}.mapCol{position:absolute;top:0;left:0;width:130px;height:400px;margin:0;padding:0}.mapNode,.mapNode.row1{top:10px}.mapCol:nth-child(2){left:130px}.mapCol:nth-child(3){left:260px}.mapCol:nth-child(4){left:390px}.mapCol:nth-child(5){left:520px}.mapCol:last-child{left:650px;width:80px}.lastMapNode,.mapNode{left:10px;width:60px;position:absolute}.mapNode{height:60px;-webkit-transition:background .25s;-moz-transition:background .25s}.mapNode.row2{top:90px}.mapNode.row3{top:170px}.mapNode.row4{top:250px}.mapNode.row5{top:330px}.lastMapNode{top:10px;height:380px;transition:background .25s;-webkit-transition:background .25s;-moz-transition:background .25s}#playArea{position:absolute;top:0;left:0;width:1500px;height:1080px}.hpBar,.room,.xpBar{left:150px;width:1200px}.border{box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;border-style:solid;border-color:#000;border-width:1px}.room{cursor:none;position:relative;top:115px;height:850px}.hpBar,.xpBar{position:absolute;background:#444}.hpBar{top:40px;height:30px}.xpBar{top:1000px;height:20px}#hpInd,#xpInd{float:left;width:0;transition:width .5s;-webkit-transition:width .5s;-moz-transition:width .5s}#hpInd{height:30px;background:#54BA56}#xpInd{height:20px;background:#2DAA9B}#hpTxt,#xpTxt{position:absolute;top:0;width:1200px;color:#FFF;text-align:center}#hpTxt{font-size:25px;line-height:30px}#xpTxt{font-size:15px;line-height:20px}.hidden{visibility:hidden}.noselect{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#story,#tutorial{position:absolute;top:175px;left:calc(50% - 500px);width:1000px;text-align:center}.clickHere{font-size:16px;line-height:30px;text-align:center}#story{top:875px;font-size:20px}.tHead{font-size:60px;line-height:70px;margin-bottom:20px}.tTxt{font-size:25px}.tLeft,.tRight{position:relative;display:inline-block;width:450px}.tLeft{float:left}.tRight{float:right}.tKey{position:absolute;font-size:30px;width:50px;height:50px;text-align:center;line-height:50px}.tKey:nth-child(1){top:20px;left:200px}.tKey:nth-child(2){top:90px;left:130px}.tKey:nth-child(3){top:90px;left:200px}.tKey:nth-child(4){top:90px;left:270px}</style></head><body><div id="container"><div id="stage" class="hidden"><div id="playArea"><div id="tutorial" class="noselect"></div><div id="story" class="txtGreen noselect"></div><canvas id="mainCanvas" class="room btnGrey"></canvas><div class="hpBar"><div id="hpInd"></div><div id="hpTxt"></div></div><div class="xpBar"><div id="xpInd"></div><div id="xpTxt"></div></div></div><div id="menu" class="noselect"><div id="menuHead"></div><div id="mainMenu" class="hidden"><div class="menuButtons"><div id="record" class="menuButton hidden"></div><div class="menuButton btnGreen" onclick="if (Menu.open()){if (Network.highestLevel > 1){Network.tutorial=false}Game.start();}">Play<div class="menuButtonSubText txtGreen">The little packet that could.</div></div><div id="tutButton" class="menuButton btnBlue hidden" onclick="if (Menu.open()){Network.tutorial=true; Game.start();}">Tutorial<div class="menuButtonSubText txtBlue">Replay through the tutorial level.</div></div></div><div class="footer">A game by Jeremy de Reuck</div></div><div id="endScreen" class="hidden"></div><div id="upgradeMenu" class="hidden"></div><div id="mapMenu" class="hidden"><div id="mapLayer" class="txtWhite"></div><canvas id="mapLines"></canvas><div id="map" class="btnGrey"></div><div id="mapLegend"><div class="legendBlock btnGreen fillGreen"></div><div class="legendText txtGreen">You</div><div class="legendBlock btnBlue"></div><div class="legendText txtBlue">Proxy</div><div class="legendBlock btnOrange txtOrange">+</div><div class="legendText txtOrange">Firewall</div><div class="legendBlock btnRed txtRed">+</div><div class="legendText txtRed">Router</div><div class="legendText txtWhite">+ Gain an additional upgrade when completing this node</div></div></div><div id="pauseMenu" class="hidden"><div id="endHead" class="txtWhite"></div><div id="endStats" class="txtGreen"></div><div class="menuButtons"><div id="resumeBtn" class="menuButton btnGreen" onclick="if (Menu.open()){Menu.toggle();}">Resume<div class="menuButtonSubText txtGreen">Get back in the fight</div></div><div class="menuButton btnBlue" onclick="if (Menu.open()){Game.start();}">Restart<div class="menuButtonSubText txtBlue">Let's try this again!</div></div><div class="menuButton btnOrange" onclick="if (Menu.open()){Menu.toggle('main');}">Main menu<div class="menuButtonSubText txtOrange">Thatâ€™s enough for now thanks</div></div></div></div></div></div></div><script>function angleBetween(a,b){return 180*Math.atan2(b.y-a.y,b.x-a.x)/Math.PI}function degToRad(a){return a/180*Math.PI}function randomInt(a,b){return Math.floor(random(a,b+.99999))}function random(a,b){return a+(b-a)*Math.random()}function getAreaOfTriangle(a,b,c){return Math.round(Math.abs(a.x*b.y+b.x*c.y+c.x*a.y-a.x*c.y-c.x*b.y-b.x*a.y)/2*100)/100}function SfxrParams(){this.setSettings=function(a){for(var b=0;b<24;b++)this[String.fromCharCode(97+b)]=a[b]||0;this.c<.01&&(this.c=.01);var c=this.b+this.c+this.e;if(c<.18){var d=.18/c;this.b*=d,this.c*=d,this.e*=d}}}function SfxrSynth(){this._params=new SfxrParams;var a,b,c,d,e,f,g,h,i,j,k,l;this.reset=function(){var a=this._params;d=100/(a.f*a.f+.001),e=100/(a.g*a.g+.001),f=1-a.h*a.h*a.h*.01,g=-a.i*a.i*a.i*1e-6,a.a||(k=.5-a.n/2,l=5e-5*-a.o),h=1+a.l*a.l*(a.l>0?-.9:10),i=0,j=1==a.m?0:(1-a.m)*(1-a.m)*2e4+32},this.totalReset=function(){this.reset();var d=this._params;return a=d.b*d.b*1e5,b=d.c*d.c*1e5,c=d.e*d.e*1e5+12,3*((a+b+c)/3|0)},this.synthWave=function(m,n){var o=this._params,p=1!=o.s||o.v,q=o.v*o.v*.1,r=1+3e-4*o.w,s=o.s*o.s*o.s*.1,t=1+1e-4*o.t,u=1!=o.s,v=o.x*o.x,w=o.g,x=o.q||o.r,y=o.r*o.r*o.r*.2,z=o.q*o.q*(o.q<0?-1020:1020),A=o.p?((1-o.p)*(1-o.p)*2e4|0)+32:0,B=o.d,C=o.j/2,D=o.k*o.k*.01,E=o.a,F=a,G=1/a,H=1/b,I=1/c,J=5/(1+o.u*o.u*20)*(.01+s);J>.8&&(J=.8),J=1-J;for(var K,L,M,N,O,P,Q=!1,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=0,$=0,_=new Array(1024),aa=new Array(32),ba=_.length;ba--;)_[ba]=0;for(var ba=aa.length;ba--;)aa[ba]=2*Math.random()-1;for(var ba=0;ba<n;ba++){if(Q)return ba;if(A&&++Z>=A&&(Z=0,this.reset()),j&&++i>=j&&(j=0,d*=h),f+=g,d*=f,d>e&&(d=e,w>0&&(Q=!0)),L=d,C>0&&($+=D,L*=1+Math.sin($)*C),L|=0,L<8&&(L=8),E||(k+=l,k<0?k=0:k>.5&&(k=.5)),++S>F)switch(S=0,++R){case 1:F=b;break;case 2:F=c}switch(R){case 0:T=S*G;break;case 1:T=1+2*(1-S*H)*B;break;case 2:T=1-S*I;break;case 3:T=0,Q=!0}x&&(z+=y,M=0|z,M<0?M=-M:M>1023&&(M=1023)),p&&r&&(q*=r,q<1e-5?q=1e-5:q>.1&&(q=.1)),P=0;for(var ca=8;ca--;){if(X++,X>=L&&(X%=L,3==E))for(var da=aa.length;da--;)aa[da]=2*Math.random()-1;switch(E){case 0:O=X/L<k?.5:-.5;break;case 1:O=1-X/L*2;break;case 2:N=X/L,N=6.28318531*(N>.5?N-1:N),O=1.27323954*N+.405284735*N*N*(N<0?1:-1),O=.225*((O<0?-1:1)*O*O-O)+O;break;case 3:O=aa[Math.abs(32*X/L|0)]}p&&(K=W,s*=t,s<0?s=0:s>.1&&(s=.1),u?(V+=(O-W)*s,V*=J):(W=O,V=0),W+=V,U+=W-K,U*=1-q,O=U),x&&(_[Y%1024]=O,O+=_[(Y-M+1024)%1024],Y++),P+=O}P*=.125*T*v,m[ba]=Math.max(-1,Math.min(1,P))||0}return n}}function jsfxr(a,b){var c,d;return synth._params.setSettings(a),d=new Float32Array(synth.totalReset()),synth.synthWave(d,d.length),c=b.createBuffer(1,d.length,44100),c.getChannelData(0).set(d),c}function Bullet(a,b,c,d,e){this.x=a,this.y=b,this.angle=c,this.damage=d,this.colour="",this.vx=0,this.vy=0,"undefined"!=typeof e?this.friendly=!e:this.friendly=!0,this.passThrough=!1,this.hitAccuracy=2,this.kill=!1,this.init(),this.calcVelocity()}function createLevel(a,b){return{map:a,connections:b}}function Enemy(a,b,c){this.mod=c,this.x=a,this.y=b,this.vx=0,this.vy=0,this.distanceToPlayerSquared=0,this.speed=0,this.range=0,this.xp=0,this.maxHp=10,this.hp=10,this.radius=14,this.colour="#FF9D00",this.dCol=["#282828","#333","#383838"],this.angle=0,this.damage=0,this.alive=!0,this.attackSpeed=1,this.attackTimer=Date.now(),this.spawnTimer=Date.now()+randomInt(-1e3,1e3),this.spawnTime=5e3,this.stopTimer=null,this.spawned=0,this.difAdj=1,this.dc=0,this.init()}function Crawler(a){this.parentObj=null,this.type=a}function Pulser(a){this.parentObj=null,this.type=a}function Particle(a,b,c){this.x=a,this.y=b,this.kill=!1,this.angle=0,this.radius=randomInt(1,5),this.speed=15,this.colour=c}var requestAnimation=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,AudioContext=window.AudioContext||window.webkitAudioContext,Point=function(a,b){this.x=a||null,this.y=b||null};Point.prototype={distance:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))}};var synth=new SfxrSynth,Game={stage:document.querySelector("#stage"),playArea:document.querySelector("#playArea"),canvas:document.querySelector("#mainCanvas"),ctx:null,width:1500,height:1080,offsetTop:0,offsetLeft:0,canvasWidth:1200,canvasHeight:850,canvasTop:115,canvasLeft:150,aspectRatio:1,clientAspectRatio:1,scale:1,paused:!0,pausedFrom:null,timerAdjust:0,shakeEnd:0,shaking:!1,shakeStr:0,glitchCount:0,glitching:!1,init:function(){this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.setScale(),window.onresize=function(){Game.setScale()},window.onblur=function(){Menu.open()||Menu.toggle("pause")},Network.init(),Input.init(),Player.init(),Network.start(),Menu.toggle("main"),this.loop()},start:function(){Player.reset(),Room.reset(),Room.story=1,Enemies.clear(),Bullets.totalBullets=0,Enemies.totalKills=0,this.timerReset(),Network.level=1,Network.goToNextLevel=!1,Network.start(),Player.availableUG>0&&!Network.tutorial?Menu.toggle("upgrade"):Menu.toggle("map")},pause:function(){this.paused||(this.paused=!0,this.pausedFrom=Date.now())},unpause:function(){this.paused&&(this.paused=!1,null!==this.pausedFrom&&(this.timerAdjust=Date.now()-this.pausedFrom,this.pausedFrom=null))},updateTimer:function(){return this.timerAdjust},timerReset:function(){this.pausedFrom=null,this.timerAdjust=0},screenShake:function(a,b){this.shakeEnd=Date.now()+b,this.shaking=!0,this.shakeStr=Math.round(a/2)},shakeScreen:function(){this.shaking&&(this.playArea.style.transform="translate("+randomInt(-this.shakeStr,this.shakeStr)+"px,"+randomInt(-this.shakeStr,this.shakeStr)+"px)",this.shakeEnd+=this.updateTimer(),Date.now()>=this.shakeEnd&&(this.shakeStr>.5?this.shakeStr-=.1*this.shakeStr:(this.playArea.style.transform="translate(0px, 0px)",this.shaking=!1,this.shakeStr=0)))},calcScale:function(){this.aspectRatio=this.width/this.height;var a=window.innerWidth/window.innerHeight;a>=this.aspectRatio?(this.scale=window.innerHeight/this.height,this.offsetTop=0,this.offsetLeft=(window.innerWidth-this.width*this.scale)/2):(this.scale=window.innerWidth/this.width,this.offsetTop=(window.innerHeight-this.height*this.scale)/2,this.offsetLeft=0),this.scale>1&&(this.scale=1)},setScale:function(){this.calcScale();var a=window.innerWidth-this.width,b=window.innerHeight-this.height;this.stage.style.left=a/2+"px",this.stage.style.top=b/2+"px",this.stage.style.transform="scale("+this.scale+")",this.stage.style.webkitTransform="scale("+this.scale+")",this.stage.style.MozTransform="scale("+this.scale+")"},loop:function(){requestAnimation(Game.loop),Game.update(),Game.render()},update:function(){this.paused||(this.shakeScreen(),Player.update(),Enemies.update(),Bullets.update(),Room.update(),FX.update(),0!==this.timerAdjust&&this.timerReset())},clearCanvas:function(){this.glitching?(this.glitchCount++,this.glitchCount>=10&&(this.glitchCount=0,this.glitching=!1)):this.canvas.width=this.canvasWidth},render:function(){if(!this.paused){if(this.clearCanvas(),!Network.tutorial)for(var a=0;a<12;a++)for(var b=0;b<10;b++){this.ctx.strokeStyle="#222",this.ctx.lineWidth=2;var c=randomInt(2*(-Network.level+1),2*(Network.level-1)),d=randomInt(2*(-Network.level+1),2*(Network.level-1));this.ctx.strokeRect(55.5*a+41+41*a+d/2,40*b+41+41*b+c/2,55.5+d/2,40+c/2)}Enemies.drawDeadEnemies(this.ctx),Bullets.draw(this.ctx),Player.draw(this.ctx),Enemies.draw(this.ctx),Player.drawCursor(this.ctx),FX.draw(this.ctx)}}},Menu={menu:document.querySelector("#menu"),menuHeading:document.querySelector("#menuHead"),btnNames:["Mutate MTU","ECC","Packet TAP","FEC","SSL inspection","Jumbo frame","Decode","Encapsulation","Bruteforce","Ping flood","Overflow","Traceroute"],btnDescripts:["Increases max health by 25%.","Gain 4% health every 3 seconds. This effect stacks.","Gain 2.5% of damage done back as health. This effect stacks.","Gain 12.5% max health and 2% health every 3 seconds.","5% higher chance for pings to pierce entities.","Chance to do critical damage increases by 5%.","Critical damage increases by 10%.","Gain 5% damage reduction for each attack.","Each ping does 20% more damage.","Shoot additional pings at the cost of accuracy.","Rate of fire increases by 4 pings per second.","Increased accuracy."],toggle:function(a){if(this.open())Game.stage.classList.contains("hidden")&&Game.stage.classList.toggle("hidden"),"undefined"==typeof a?(this.menu.classList.toggle("show"),Game.unpause(),Game.stage.classList.contains("hidden")&&Game.stage.classList.toggle("hidden")):Game.stage.classList.contains("hidden")||(Game.stage.classList.toggle("hidden"),this.menu.classList.toggle("show"),setTimeout(function(){Menu.toggle(a)},500));else{if(document.querySelector("#mainMenu").className="hidden",document.querySelector("#endScreen").className="hidden",document.querySelector("#upgradeMenu").className="hidden",document.querySelector("#mapMenu").className="hidden",document.querySelector("#pauseMenu").className="hidden","main"===a||"undefined"==typeof a)this.menuHeading.innerHTML="Nexus overload",!Network.tutorial&&document.querySelector("#tutButton").classList.contains("hidden")&&(document.querySelector("#tutButton").classList.toggle("hidden"),document.querySelector("#record").classList.toggle("hidden")),document.querySelector("#record").innerHTML="Record: "+Network.highestLevel+"<div class='menuButtonSubText txtGrey'>You will get "+Math.floor(Network.highestLevel/2)+" free upgrade(s) when you try again.</div>",document.querySelector("#mainMenu").classList.toggle("hidden");else if("pause"===a)this.menuHeading.innerHTML="Paused",document.querySelector("#endHead").innerHTML="",document.querySelector("#endStats").innerHTML="",document.querySelector("#resumeBtn").className="menuButton btnGreen",document.querySelector("#pauseMenu").classList.toggle("hidden");else if("end"===a)this.menuHeading.innerHTML="Game over",document.querySelector("#endHead").innerHTML="Reached network layer "+Network.level,document.querySelector("#endStats").innerHTML="You killed "+Enemies.totalKills+" enemies<br/>and sent "+Bullets.totalBullets+" ping requests!",document.querySelector("#resumeBtn").className="menuButton btnGreen hidden",document.querySelector("#pauseMenu").classList.toggle("hidden");else if("upgrade"===a){this.menuHeading.innerHTML="Packet glitch",document.querySelector("#upgradeMenu").classList.toggle("hidden");var b="<div class='ugHead txtWhite'>";b+=1===Network.level&&0===Network.currentCol?"You have "+Player.availableUG+" source upgrade(s) remaining":"You have "+Player.availableUG+" upgrade(s) to choose",b+="</div><div class='menuButtons'>";for(var c=["btnGreen","btnBlue","btnOrange"],d=["txtGreen","txtBlue","txtOrange"],e=[randomInt(0,3),randomInt(4,7),randomInt(8,11)],f=0;f<3;f++)b+="<div class='menuButton "+c[f]+"' onclick='Player.upgrade("+e[f]+");''>"+this.btnNames[e[f]]+"<div class='menuButtonSubText "+d[f]+"'>"+this.btnDescripts[e[f]]+"</div></div>";b+="</div>",document.querySelector("#upgradeMenu").innerHTML=b}else"map"===a&&(this.menuHeading.innerHTML="Network map",document.querySelector("#mapMenu").classList.toggle("hidden"));this.menu.classList.toggle("show"),Game.pause()}},open:function(){return!!this.menu.classList.contains("show")}},Input={mouse:new Point(0,0),canvasMouse:new Point(0,0),mouseDown:!1,up:!1,down:!1,left:!1,right:!1,init:function(){this.addKeyboardListeners(),this.addMouseListeners()},addMouseListeners:function(){document.addEventListener("mousemove",Input.updateMouseCoordinates),document.addEventListener("mousedown",Input.onMouseDown),document.addEventListener("mouseup",Input.onMouseUp)},updateMouseCoordinates:function(a){Input.mouse.x=a.clientX,Input.mouse.y=a.clientY,Input.canvasMouse.x=(a.clientX-Game.canvasLeft*Game.scale-Game.offsetLeft)/Game.scale,Input.canvasMouse.y=(a.clientY-Game.canvasTop*Game.scale-Game.offsetTop)/Game.scale},onMouseDown:function(a){a.preventDefault(),Input.mouseDown=!0},onMouseUp:function(a){Input.mouseDown=!1},addKeyboardListeners:function(){document.addEventListener("keydown",Input.keyDown),document.addEventListener("keyup",Input.keyUp)},keyDown:function(a){87===a.which&&(Input.up=!0),65===a.which&&(Input.left=!0),83===a.which&&(Input.down=!0),68===a.which&&(Input.right=!0),27===a.which&&(Menu.open()?"Paused"===Menu.menuHeading.innerHTML?Menu.toggle():"Nexus overload"!==Menu.menuHeading.innerHTML&&Menu.toggle("main"):Menu.toggle("pause"))},keyUp:function(a){87===a.which&&(Input.up=!1),65===a.which&&(Input.left=!1),83===a.which&&(Input.down=!1),68===a.which&&(Input.right=!1)}};Bullet.prototype={init:function(){this.friendly?(this.passThrough=Math.random()<Player.bullestPassThrough,this.passThrough?this.colour="#38FF00":this.colour="#9FF1FF",Math.random()<Player.crit&&(this.damage+=Math.floor(this.damage*Player.critDamage),this.colour="#FFE600",this.passThrough&&(this.colour="#FFF"))):this.colour="#FF5C87"},calcVelocity:function(){this.vx=Math.cos(degToRad(this.angle))*Bullets.speed,this.vy=Math.sin(degToRad(this.angle))*Bullets.speed},move:function(){this.x+=this.vx,this.y+=this.vy,this.remove()},hit:function(){if(this.friendly){for(var a in Enemies.enemies)if(Enemies.enemies[a].alive&&!this.kill){for(var b=!1,c=0;c<this.hitAccuracy;c++)this.x+this.vx*(c/this.hitAccuracy)<=Enemies.enemies[a].x+Enemies.enemies[a].radius&&this.x+this.vx*(c/this.hitAccuracy)>=Enemies.enemies[a].x-Enemies.enemies[a].radius&&this.y+this.vy*(c/this.hitAccuracy)<=Enemies.enemies[a].y+Enemies.enemies[a].radius&&this.y+this.vy*(c/this.hitAccuracy)>=Enemies.enemies[a].y-Enemies.enemies[a].radius&&(b=!0);b&&(this.passThrough||(this.kill=!0),Enemies.enemies[a].takeDamage(this.damage),this.damage>=Player.damage&&Sound.play("damage"),Player.gainHP(Player.lifeSteal*this.damage),Player.lifeSteal>0&&FX.createParticles(Enemies.enemies[a].x,Enemies.enemies[a].y,Math.min(Math.ceil(Player.lifeSteal*this.damage),10),Enemies.enemies[a].colour),this.damage=Math.round(.5*this.damage))}}else for(var d=0;d<this.hitAccuracy;d++)if(this.x+this.vx*(d/this.hitAccuracy)<=Player.x+37&&this.x+this.vx*(d/this.hitAccuracy)>=Player.x-37&&this.y+this.vy*(d/this.hitAccuracy)<=Player.y+37&&this.y+this.vy*(d/this.hitAccuracy)>=Player.y-37&&Player.collidingPoint(this.x+this.vx*(d/this.hitAccuracy),this.y+this.vy*(d/this.hitAccuracy))){Player.takeDamage(this.damage),this.kill=!0;break}},remove:function(){this.x<0||this.x>Game.canvasWidth?this.kill=!0:(this.y<0||this.y>Game.canvasHeight)&&(this.kill=!0)},draw:function(a){a.strokeStyle=this.colour,a.lineWidth=2,a.beginPath(),a.moveTo(this.x,this.y),a.lineTo(this.x+this.vx,this.y+this.vy),a.stroke()}};var Bullets={bullets:[],totalBullets:0,bulletSpray:5,bulletsPerShot:1,speed:20,fireBullet:function(a,b,c,d,e,f){if(this.speed=e||20,"undefined"!=typeof f&&f)for(var g=0;g<this.bulletsPerShot;g++)this.bullets.push(new Bullet(a,b,c+random(-this.bulletSpray,this.bulletSpray),d,f));else for(var h=0;h<Player.bulletsPerShot;h++)this.bullets.push(new Bullet(a,b,c+random(-Player.bulletSpray,Player.bulletSpray),d,f)),this.totalBullets++},update:function(){this.clean();for(var a=0;a<this.bullets.length;a++)this.bullets[a].move(),this.bullets[a].hit()},draw:function(a){for(var b=0;b<this.bullets.length;b++)this.bullets[b].draw(a)},clean:function(){for(var a=this.bullets.length-1;a>=0;a--)this.bullets[a].kill&&this.bullets.splice(a,1)},clear:function(){this.bullets=[]}},Player={xpBarElem:document.querySelector("#xpInd"),hpBarElem:document.querySelector("#hpInd"),xpTextElem:document.querySelector("#xpTxt"),hpTextElem:document.querySelector("#hpTxt"),x:50,y:Game.canvasHeight/2,width:60,height:40,colour:["#808080","#3EDBFF","#F00","#0F0","#0FF","#FFF"],angle:0,bulletSpeed:20,top:new Point(0,0),bottomLeft:new Point(0,0),bottomRight:new Point(0,0),area:0,hpTopLeft:new Point(0,0),hpWidth:50,distanceToMouse:0,lvlAnim:0,init:function(){this.calcTriPoints(),this.area=getAreaOfTriangle(this.top,this.bottomLeft,this.bottomRight),this.reset()},reset:function(){this.alive=!0,this.deathTime=null,this.armor=0,this.maxHp=100,this.hp=100,this.hpRegen=0,this.hpTimer=Date.now(),this.availableUG=Math.floor(Network.highestLevel/2),Network.tutorial&&(this.availableUG=0),this.xp=0,this.prevLevelXP=0,this.nextLevelXP=40,this.level=1,this.speed=6,this.bulletRate=4,this.bulletTimer=null,this.bulletSpray=1.5,this.bulletsPerShot=1,this.bullestPassThrough=0,this.damage=20,this.lifeSteal=0,this.crit=.01,this.critDamage=.5;var a=this.nextLevelXP-this.prevLevelXP,b=this.xp-this.prevLevelXP;this.xpBarElem.style.width=Math.round(b/a*100)+"%",this.xpTextElem.innerHTML=b+" / "+a+" bits",this.hpBarElem.style.width="0%",this.moveToStart()},rotate:function(){this.alive&&(this.angle=angleBetween(new Point(this.x,this.y),Input.canvasMouse))},move:function(){this.alive&&(Input.up&&Input.down||(Input.up?this.y-=this.speed:Input.down&&(this.y+=this.speed)),Input.left&&Input.right||(Input.left?this.x-=this.speed:Input.right&&(this.x+=this.speed))),this.calcTriPoints(),this.insideRoom()},moveToStart:function(){this.x=50,this.y=Game.canvasHeight/2},insideRoom:function(){for(;this.top.x<0||this.bottomLeft.x<0||this.bottomRight.x<0;)this.x++,this.calcTriPoints();for(;this.top.x>Game.canvasWidth||this.bottomLeft.x>Game.canvasWidth||this.bottomRight.x>Game.canvasWidth;)this.x--,this.calcTriPoints();for(;this.top.y<0||this.bottomLeft.y<0||this.bottomRight.y<0;)this.y++,this.calcTriPoints();for(;this.top.y>Game.canvasHeight||this.bottomLeft.y>Game.canvasHeight||this.bottomRight.y>Game.canvasHeight;)this.y--,this.calcTriPoints()},calcTriPoints:function(){this.top.x=this.x+Math.cos(degToRad(this.angle))*(this.width/2),this.top.y=this.y+Math.sin(degToRad(this.angle))*(this.width/2),this.bottomLeft.x=this.x+Math.cos(degToRad((this.angle+180)%360))*(this.width/2),this.bottomLeft.y=this.y+Math.sin(degToRad((this.angle+180)%360))*(this.width/2),this.bottomRight.x=this.bottomLeft.x+Math.cos(degToRad((this.angle-90)%360))*(this.height/2),this.bottomRight.y=this.bottomLeft.y+Math.sin(degToRad((this.angle-90)%360))*(this.height/2),this.bottomLeft.x+=Math.cos(degToRad((this.angle+90)%360))*(this.height/2),this.bottomLeft.y+=Math.sin(degToRad((this.angle+90)%360))*(this.height/2)},shoot:function(){Input.mouseDown&&this.alive?(null===this.bulletTimer&&(this.bulletTimer=Date.now(),Bullets.fireBullet(this.x,this.y,this.angle,this.damage,this.bulletSpeed),Sound.play("shoot")),this.bulletTimer+=Game.updateTimer(),Date.now()-this.bulletTimer>1e3/this.bulletRate&&(this.bulletTimer=null)):null!==this.bulletTimer&&(this.bulletTimer=null)},takeDamage:function(a){if(this.alive){var b=Math.floor(a-a*this.armor);b>=this.hp?(this.hp=0,this.alive=!1,Game.screenShake(150,250),Sound.play("die"),this.deathTime=Date.now()):(this.hp-=b,Game.screenShake(Math.floor(b/this.maxHp*50),10),Sound.play("damage"))}},gainXP:function(a){this.xp+=a,this.xp>=this.nextLevelXP&&(this.prevLevelXP=this.nextLevelXP,this.nextLevelXP+=this.nextLevelXP,this.availableUG++,Sound.play("level"),this.hp=this.maxHp,this.lvlAnim=30);var b=this.nextLevelXP-this.prevLevelXP,c=this.xp-this.prevLevelXP;this.xpBarElem.style.width=Math.round(c/b*100)+"%",this.xpTextElem.innerHTML=c+" / "+b+" bits"},regenHP:function(){this.alive&&(this.hpTimer+=Game.updateTimer(),Date.now()>=this.hpTimer+3e3&&(this.hpTimer=Date.now(),this.gainHP(Math.floor(this.hpRegen*this.maxHp))))},update:function(){this.move(),this.rotate(),this.shoot(),this.distanceToMouse=Math.sqrt(Math.pow(Player.x-Input.canvasMouse.x,2)+Math.pow(Player.y-Input.canvasMouse.y,2)),this.regenHP(),this.alive||null===this.deathTime||(this.deathTime+=Game.updateTimer(),Date.now()>=this.deathTime+1250&&(Menu.toggle("end"),this.deathTime=null))},collidingPoint:function(a,b){var c=getAreaOfTriangle({x:a,y:b},this.top,this.bottomLeft);if(c>this.area)return!1;var d=getAreaOfTriangle({x:a,y:b},this.top,this.bottomRight);if(c+d>this.area)return!1;var e=getAreaOfTriangle({x:a,y:b},this.bottomRight,this.bottomLeft);return c+d+e===this.area},upgrade:function(a){if(this.availableUG>0&&Menu.open()){switch(this.level++,this.availableUG--,a){case 0:this.maxHp+=Math.floor(.25*this.maxHp),this.hp+=Math.floor(.25*this.hp);break;case 1:this.hpRegen+=.04;break;case 2:this.lifeSteal+=.025;break;case 3:this.maxHp+=Math.floor(.125*this.maxHp),this.hp+=Math.floor(.125*this.hp),this.hpRegen+=.02;break;case 4:this.bullestPassThrough+=.05;break;case 5:this.crit+=.05;break;case 6:this.critDamage+=.1;break;case 7:this.armor+=.05,this.armor>.9&&(this.armor=.9);break;case 8:this.damage+=Math.floor(.2*this.damage);break;case 9:this.bulletsPerShot++,this.bulletsPerShot>20?this.bulletsPerShot=20:this.damage-=Math.floor(.3*this.damage),this.bulletSpray+=1.5,this.bulletSpray>20&&(this.bulletSpray=20);break;case 10:this.bulletRate+=4,this.bulletRate>50?this.bulletRate=50:this.damage-=Math.floor(.3*this.damage),this.bulletSpray++,this.bulletSpray>20&&(this.bulletSpray=20);break;case 11:this.bulletSpray-=2,this.bulletSpray<.5&&(this.bulletSpray=.5)}0===this.availableUG?Menu.toggle("map"):Menu.toggle("upgrade")}},gainHP:function(a){this.hp+=a,this.hp>this.maxHp&&(this.hp=this.maxHp)},drawHp:function(a){this.alive?(this.hpBarElem.style.width=Math.round(this.hp/this.maxHp*100)+"%",this.hpTextElem.innerHTML=Math.round(this.hp)+" / "+this.maxHp+" MTU"):(this.hpBarElem.style.width="0%",this.hpTextElem.innerHTML="0 / "+this.maxHp+" MTU")},draw:function(a){this.drawHp(a);var b=0;if(this.alive){var c=1;if(Input.mouseDown&&(c=Math.min(Math.floor(this.bulletsPerShot+this.bulletRate/10),5)),a.fillStyle=this.colour[randomInt(1,c)],b=Math.min(50*(this.armor/10+(this.crit-.01)/10+(this.critDamage-.5)/20)+Math.floor(this.level/3),7),this.lvlAnim>0){a.strokeStyle="#999",a.lineWidth=this.lvlAnim/5;for(var d=0;d<5;d++)a.beginPath(),a.arc(this.x,this.y,(30-this.lvlAnim)*d,0,2*Math.PI),a.stroke(),this.lvlAnim-=.2}}else a.fillStyle=this.colour[0];a.beginPath(),a.moveTo(this.top.x+randomInt(-b,b),this.top.y+randomInt(-b,b)),a.lineTo(this.bottomRight.x+randomInt(-b,b),this.bottomRight.y+randomInt(-b,b)),a.lineTo(this.bottomLeft.x+randomInt(-b,b),this.bottomLeft.y+randomInt(-b,b)),a.closePath(),a.fill()},drawCursor:function(a){a.strokeStyle="#484848",a.fillStyle="#EEE",a.lineWidth=1,a.beginPath(),a.arc(Input.canvasMouse.x,Input.canvasMouse.y,.0175*this.bulletSpray*this.distanceToMouse,0,2*Math.PI),a.stroke(),a.beginPath(),a.arc(Input.canvasMouse.x,Input.canvasMouse.y,2.5,0,2*Math.PI),a.fill()}},Room={clear:!1,exitTime:null,story:1,tutorialElem:document.querySelector("#tutorial"),storyElem:document.querySelector("#story"),start:function(a){if(Game.timerReset(),this.nextStory(),FX.clear(),document.querySelector("#mainCanvas").className="room btnGrey",this.story<=6&&Network.tutorial){if(this.story-1===1||this.story-1===2)for(var b=0;b<3;b++)Enemies.spawnCrawler(1e3,375+50*b,1);else if(this.story-1===3)for(var c=0;c<3;c++){var d=1;1===c&&(d=2),Enemies.spawnCrawler(1e3,325+50*c,d)}else if(this.story-1===4)for(var e=0;e<5;e++)Enemies.spawnCrawler(1e3,325+50*e,1);else if(this.story-1===5){document.querySelector("#mainCanvas").className="room btnRed";for(var f=0;f<3;f++)Enemies.spawnCrawler(1e3,325+100*f,1);for(var g=0;g<2;g++)Enemies.spawnCrawler(1e3,375+100*g,2)}Enemies.setSpeed(.5)}else a===-1?(document.querySelector("#mainCanvas").className="room btnRed",this.spawnElite(),this.spawnMob(),this.spawnMob()):5===a?(document.querySelector("#mainCanvas").className="room btnBlue",this.spawnElite()):6===a?(document.querySelector("#mainCanvas").className="room btnOrange",this.spawnBoss(),Player.availableUG++):this.spawnMob()},spawnMob:function(){var a=randomInt(2*Network.level,3*Network.level),b=randomInt(Network.level,2*Network.level);Enemies.spawnCrawlerDen(a,1),Enemies.spawnPulserDen(b,1)},spawnElite:function(){this.spawnMob();var a=randomInt(Math.ceil(.5*Network.level),Math.ceil(.75*Network.level)),b=randomInt(Math.ceil(.25*Network.level),Math.ceil(.5*Network.level));Enemies.spawnCrawlerDen(a,2),Enemies.spawnPulserDen(b,2)},spawnBoss:function(){this.spawnElite();var a=randomInt(Math.ceil(.25*Network.level),Math.ceil(.5*Network.level)),b=randomInt(Math.ceil(.1*Network.level),Math.ceil(.25*Network.level));Enemies.spawnCrawlerDen(a,3),Enemies.spawnPulserDen(b,3)},reset:function(){this.clear=!1,this.exitTime=null,Bullets.clear(),Enemies.clear(),Player.moveToStart()},nextStory:function(){if(this.tutorialElem.innerHTML="",this.storyElem.innerHTML="",this.story<=5&&Network.tutorial){var a="<div class='tHead txtWhite'>",b="<em>";1===this.story?(a="<div class='tHead txtWhite tLeft'>",a+="Movement",a+="</div><div class='tHead txtWhite tRight'>",a+="Attack",a+="</div><div class='tLeft'>",a+="<div class='tKey btnBlue txtBlue'>W</div>",a+="<div class='tKey btnBlue txtBlue'>A</div>",a+="<div class='tKey btnBlue txtBlue'>S</div>",a+="<div class='tKey btnBlue txtBlue'>D</div>",a+="</div><div class='tRight tTxt txtOrange'>",a+="Mouse to aim<br/>Left mouse to shoot",b+="There once was a little data-packet,<br/>trapped in a looped network."):2===this.story?(a+="Data Gain",a+="</div><div class='tTxt txtOrange'>",a+="Overload crawlers and pulsars with<br/>ping requests to gain their data bits.",b+="He found a way to glitch the system,<br/>overloading the hostile entities and learning their secrets."):3===this.story?b+="The data gained through his experience helped<br/>him to understand how to bend the Nexus to his advantage.":4===this.story?b+="The little packet was convinced he would fulfil his destiny,<br/>unaware that the looping Nexus was just drawing him in deeper.":5===this.story&&(a+="Nexus source",a+="</div><div class='tTxt txtOrange'>",a+="For every two layers you complete, you gain<br/>one free upgrade on your future play-throughs.",b+="As the little packet moved deeper through the Nexus, his<br/>understanding of the source grew and he knew this would serve him well one day."),a+="</div>",b+="</em>",this.tutorialElem.innerHTML=a,this.storyElem.innerHTML=b,this.story++}},update:function(){!this.clear&&Enemies.enemiesKilled()&&(this.clear=!0,this.exitTime=Date.now()+500),null!==this.exitTime&&(this.exitTime+=Game.updateTimer()),null!==this.exitTime&&Date.now()>=this.exitTime&&Player.alive&&(this.exitTime=null,Network.updateMap(),Player.availableUG>0?Menu.toggle("upgrade"):Menu.toggle("map"))}},Network={mapElem:document.querySelector("#map"),mapCtx:document.querySelector("#mapLines").getContext("2d"),mapHead:document.querySelector("#mapLayer"),width:730,height:400,level:1,highestLevel:1,layer:0,colour:[],currentRow:0,currentCol:0,workingMap:[],goToNextLevel:!1,tutorial:!0,levelData:[createLevel([[0,0,0,0,0],[0,0,0,0,0],[1,3,3,3,3],[0,0,0,0,0],[0,0,0,0,0]],[[[],[],[],[],[]],[[],[],[],[],[]],[[2],[2],[2],[2],[2]],[[],[],[],[],[]],[[],[],[],[],[]]]),createLevel([[0,0,0,0,3],[0,5,3,5,5],[1,0,5,6,3],[0,3,0,3,0],[0,0,3,6,5]],[[[],[],[],[],[0]],[[],[1,2],[1,2],[0,1],[1]],[[1,3],[],[2,3],[1,2],[2]],[[],[2,4],[],[2,4],[]],[[],[],[3,4],[4],[4]]]),createLevel([[0,0,3,0,3],[0,5,0,5,0],[1,3,3,0,6],[0,0,5,5,0],[0,0,0,6,3]],[[[],[],[1],[],[0]],[[],[0],[],[0,2],[]],[[1,2],[2,3],[1,3],[],[2]],[[],[],[3,4],[2,4],[]],[[],[],[],[4],[4]]]),createLevel([[0,0,0,0,5],[0,0,3,6,0],[1,3,3,5,3],[0,5,3,0,6],[0,0,0,5,3]],[[[],[],[],[],[0]],[[],[],[1,2],[0,2],[]],[[2,3],[1,2],[2],[2,3],[2]],[[],[3],[2,4],[],[3]],[[],[],[],[3,4],[4]]]),createLevel([[0,0,3,5,0],[0,3,5,6,3],[1,0,3,5,5],[0,5,5,0,6],[0,0,3,3,3]],[[[],[],[0,1],[1],[]],[[],[0,1,2],[1,2],[1],[1]],[[1,3],[],[2],[1,2,3],[2]],[[],[3,4],[2,4],[],[3]],[[],[],[4],[3,4],[4]]]),createLevel([[0,0,5,5,6],[0,5,3,0,3],[1,3,3,3,0],[0,0,5,0,6],[0,0,0,5,3]],[[[],[],[0],[0,1],[0]],[[],[0,1],[2],[],[1]],[[1,2],[2,3],[2],[1,3],[]],[[],[],[2,4],[],[3]],[[],[],[],[3,4],[4]]])],init:function(){this.colour[0]="rgba(0,0,0,0)",this.colour[1]="#24FF96",this.colour[2]="#FFF",this.colour[3]="#808080",this.colour[4]="#282828",this.colour[5]="#3EFFEC",this.colour[6]="#FF945F"},start:function(){this.level>1&&(this.tutorial=!1),this.tutorial?this.layer=0:this.layer=randomInt(1,5),this.currentRow=2,this.currentCol=0;for(var a=0;a<5;a++){this.workingMap[a]=[];for(var b=0;b<5;b++)this.workingMap[a][b]=this.levelData[this.layer].map[a][b]}this.showMap()},showMap:function(){this.mapElem.innerHTML="",this.mapHead.innerHTML="Network layer: "+this.level;for(var a="",b=[" btnGreen fillGreen"," btnWhite fillWhite"," btnGrey"," btnDarkGrey"," btnBlue"," btnOrange"],c=0;c<this.currentCol+2&&c<5;c++){a+="<div class='mapCol'>";for(var d=0;d<5;d++)if(0!==this.workingMap[d][c]){if(a+="<div onclick='Network.goToNode(this);' data-row='"+d+"' data-col='"+c+"' class='mapNode row"+(d+1)+b[this.workingMap[d][c]-1],c===this.currentCol+1)for(var e in this.levelData[this.layer].connections[this.currentRow][this.currentCol])this.levelData[this.layer].connections[this.currentRow][this.currentCol][e]===d&&(a+=" next");a+=Network.tutorial&&0===this.currentCol&&1===c?" txtWhite clickHere'>click here</div>":"'></div>"}a+="</div>"}a+="<div onclick='Network.goToLastNode();' class='mapCol'> <div class='lastMapNode btnRed",4===this.currentCol&&(a+=" next"),a+="'></div> </div>",this.mapElem.innerHTML=a,this.strokeConnections()},strokeConnections:function(){document.querySelector("#mapLines").width=this.width,document.querySelector("#mapLines").height=this.height;for(var a=0;a<5;a++)for(var b=0;b<this.currentCol+1;b++)if(0!==this.workingMap[a][b]){this.mapCtx.strokeStyle=this.colour[this.workingMap[a][b]],this.mapCtx.lineWidth=4;for(var c=this.levelData[this.layer].connections,d=0;d<c[a][b].length;d++)2!==this.workingMap[a][b]||1!==this.workingMap[c[a][b][d]][b+1]&&2!==this.workingMap[c[a][b][d]][b+1]?2===this.workingMap[a][b]&&(this.mapCtx.strokeStyle=this.colour[4]):this.mapCtx.strokeStyle=this.colour[this.workingMap[a][b]],this.mapCtx.beginPath(),this.mapCtx.moveTo(72+130*b,40+80*a),this.mapCtx.lineTo(138+130*b,40+80*c[a][b][d]),this.mapCtx.stroke()}},goToNode:function(a){var b=parseInt(a.dataset.row),c=parseInt(a.dataset.col);if(Menu.open()&&this.currentCol+1===c&&a.classList.contains("next")){this.workingMap[this.currentRow][this.currentCol]=2,this.currentRow=b,this.currentCol=c;var d=this.workingMap[b][c];this.workingMap[b][c]=1,this.updateNodes(),Room.reset(),Room.start(d),Menu.toggle()}},goToLastNode:function(){var a=document.querySelector(".lastMapNode");Menu.open()&&a.classList.contains("next")&&(this.currentCol=0,this.goToNextLevel=!0,Player.availableUG++,Room.reset(),Room.start(-1),Menu.toggle())},updateNodes:function(){var a=[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]];a[this.currentRow][this.currentCol]=1;for(var b=this.levelData[this.layer].connections,c=this.currentCol;c<5;c++)for(var d=0;d<5;d++)if(0!==a[d][c])for(var e in b[d][c])a[b[d][c][e]][c+1]=1;for(var f=this.currentCol;f<5;f++)for(var g=0;g<5;g++)0!==this.workingMap[g][f]&&1!==this.workingMap[g][f]&&2!==this.workingMap[g][f]&&0===a[g][f]&&(this.workingMap[g][f]=4)},updateMap:function(){this.goToNextLevel&&(this.nextLevel(),this.goToNextLevel=!1,Player.maxHp+=Math.round(Network.level*Network.level*.75-(Network.level-1)*(Network.level-1)*.75),Player.hp=Player.maxHp,Player.damage+=Math.floor((Network.level*Network.level-(Network.level-1)*(Network.level-1))/Player.bulletsPerShot)),this.showMap()},nextLevel:function(){this.level++,this.highestLevel<this.level&&(this.highestLevel=this.level),this.start()}};Enemy.prototype={init:function(){this.mod.init(this),this.xp=Math.round(10*Network.level*this.mod.type*this.difAdj),this.maxHp=Math.round(Network.level*Network.level*this.difAdj*2*this.mod.type+(20+30*this.difAdj)),this.hp=this.maxHp,this.damage=Math.round(.25*(Network.level*Network.level*this.difAdj*this.mod.type+20*this.difAdj))},calcVelocity:function(){this.mod.calcVelocity()},move:function(){for(this.x+=this.vx,this.y+=this.vy;this.x-this.radius<0;)this.x++,this.followPlayer();for(;this.x+this.radius>Game.canvasWidth;)this.x--,this.followPlayer();for(;this.y-this.radius<0;)this.y++,this.followPlayer();for(;this.y+this.radius>Game.canvasHeight;)this.y--,
this.followPlayer()},attack:function(){this.mod.attack()},takeDamage:function(a){var b=Math.round(a-a*(.25*(this.mod.type-1)));this.alive&&(b>=this.hp?(this.hp=0,this.alive=!1,Player.gainXP(this.xp),Sound.play("enemyDie"),3===this.mod.type&&(Game.screenShake(15,200),Sound.play("bossDie")),this.dc=0):(this.hp-=b,this.dc=3))},followPlayer:function(){this.angle=angleBetween(new Point(this.x,this.y),new Point(Player.x,Player.y))},update:function(){this.alive&&(this.mod.update(),this.special(),this.calcVelocity(),0===this.vx&&0===this.vy||(this.angle+=randomInt(-15,15)),this.move(),this.attack())},drawHp:function(a){a.strokeStyle="#A0A0A0",a.lineWidth=2,a.beginPath(),a.moveTo(this.x-this.radius,this.y-2*this.radius),a.lineTo(this.x+this.radius,this.y-2*this.radius),a.stroke(),a.strokeStyle="#FF5A5A",a.beginPath(),a.moveTo(this.x-this.radius,this.y-2*this.radius),a.lineTo(this.x-this.radius+2*this.radius*Math.max(this.hp/this.maxHp,0),this.y-2*this.radius),a.stroke()},draw:function(a){a.fillStyle=this.colour,this.alive?this.dc>0&&(this.dc--,a.fillStyle="#DDD"):a.fillStyle=this.dCol[randomInt(0,2)],a.save(),a.translate(this.x,this.y),a.rotate(this.angle%360*Math.PI/180),a.translate(-this.x,-this.y),a.beginPath(),this.mod.draw(a),a.restore(),this.alive&&this.drawHp(a)},special:function(){Player.alive&&this.alive&&3===this.mod.type&&(this.spawnTimer+=Game.updateTimer(),Date.now()>=this.spawnTimer+this.spawnTime&&(this.speed=0,this.colour="#FFF",Date.now()>=this.spawnTimer+this.spawnTime+250&&(Date.now()>=this.spawnTimer+this.spawnTime+250+500*this.spawned&&(this.spawned++,Sound.play("bossSpawn"),this.mod.spawnMinion()),this.spawned>=Network.level&&(this.spawnTimer=Date.now(),this.stopTimer=Date.now(),this.spawned=0))),null!==this.stopTimer&&(this.stopTimer+=Game.updateTimer(),Date.now()>=this.stopTimer+250&&(this.stopTimer=null,this.speed=this.mod.speed,this.colour=this.mod.colour)))}},Crawler.prototype={init:function(a){this.parentObj=a,this.parentObj.difAdj=.7,this.parentObj.speed=2+this.type/2,this.parentObj.range=50+30*(this.type-1),this.parentObj.radius=14+10*(this.type-1),1===this.type?this.parentObj.colour="#FF9D00":2===this.type?this.parentObj.colour="#C63E02":this.parentObj.colour="#C41205",this.parentObj.angle=0,this.parentObj.alive=!0,this.parentObj.attackSpeed=3,this.speed=this.parentObj.speed,this.colour="#C41205"},calcVelocity:function(){this.parentObj.distanceToPlayerSquared=Math.pow(Player.x-this.parentObj.x,2)+Math.pow(Player.y-this.parentObj.y,2),this.parentObj.distanceToPlayerSquared>Math.pow(this.parentObj.range,2)?(this.parentObj.vx=Math.cos(degToRad(this.parentObj.angle))*this.parentObj.speed,this.parentObj.vy=Math.sin(degToRad(this.parentObj.angle))*this.parentObj.speed):(this.parentObj.vx=0,this.parentObj.vy=0)},attack:function(){this.parentObj.distanceToPlayerSquared<=Math.pow(this.parentObj.range,2)&&Player.alive&&(this.parentObj.attackTimer+=Game.updateTimer(),Date.now()-this.parentObj.attackTimer>1e3/this.parentObj.attackSpeed&&(this.parentObj.attackTimer=Date.now(),Player.takeDamage(this.parentObj.damage),Sound.play("enemyAttack")))},update:function(){this.parentObj.followPlayer()},draw:function(a){a.fillRect(this.parentObj.x-this.parentObj.radius,this.parentObj.y-this.parentObj.radius,2*this.parentObj.radius,2*this.parentObj.radius)},spawnMinion:function(){Math.random()<.85?Enemies.spawnCrawler(this.parentObj.x,this.parentObj.y,1):Enemies.spawnCrawler(this.parentObj.x,this.parentObj.y,2)}},Pulser.prototype={init:function(a){this.parentObj=a,this.parentObj.difAdj=1,this.parentObj.speed=2,this.parentObj.range=500,this.parentObj.radius=20+10*(this.type-1),1===this.type?this.parentObj.colour="#E461FF":2===this.type?this.parentObj.colour="#B71D93":this.parentObj.colour="#D10554",this.parentObj.angle=randomInt(0,359),this.parentObj.alive=!0,this.parentObj.attackSpeed=.5,this.bulletSpeed=10,this.parentObj.attackTimer+=randomInt(-1e3,1e3),this.speed=this.parentObj.speed,this.colour="#D10554"},calcVelocity:function(){this.parentObj.angle+=randomInt(-10,10),this.parentObj.vx=Math.cos(degToRad(this.parentObj.angle))*this.parentObj.speed,this.parentObj.vy=Math.sin(degToRad(this.parentObj.angle))*this.parentObj.speed},attack:function(){if(Player.alive&&(this.parentObj.attackTimer+=Game.updateTimer(),Date.now()-this.parentObj.attackTimer>1e3/this.parentObj.attackSpeed)){this.parentObj.attackTimer=Date.now();for(var a=0;a<360;a+=Math.floor(18))Bullets.fireBullet(this.parentObj.x,this.parentObj.y,a,this.parentObj.damage,this.bulletSpeed,!0);Sound.play("enemyAttack")}},update:function(){},draw:function(a){var b=0;this.parentObj.alive&&(b=randomInt(2*-this.type,2*this.type)),a.arc(this.parentObj.x,this.parentObj.y,this.parentObj.radius+b,0,2*Math.PI),a.fill()},spawnMinion:function(){Math.random()<.85?Enemies.spawnPulser(this.parentObj.x,this.parentObj.y,1):Enemies.spawnPulser(this.parentObj.x,this.parentObj.y,2)}};var Enemies={totalKills:0,enemies:[],deadEnemies:[],spawn:function(a,b,c){this.enemies[this.enemies.length]=new Enemy(a,b,c)},clean:function(){for(var a=this.enemies.length-1;a>=0;a--)this.enemies[a].alive||(this.deadEnemies.push(this.enemies[a]),this.enemies.splice(a,1),this.totalKills++)},update:function(){this.clean();for(var a in this.enemies)this.enemies[a].update()},draw:function(a){for(var b=this.enemies.length-1;b>=0;b--)this.enemies[b].draw(a)},drawDeadEnemies:function(a){for(var b in this.deadEnemies)this.deadEnemies[b].draw(a)},spawnCrawlerDen:function(a,b){for(var c=0;c<a;c++){var d=randomInt(300,Game.canvasWidth-300),e=randomInt(200,Game.canvasHeight-200);this.spawnCrawler(d,e,b)}},spawnCrawler:function(a,b,c){Enemies.spawn(a,b,new Crawler(c))},spawnPulser:function(a,b,c){this.spawn(a,b,new Pulser(c))},spawnPulserDen:function(a,b){for(var c=0;c<a;c++){var d=randomInt(500,Game.canvasWidth-500),e=randomInt(400,Game.canvasHeight-400);this.spawnPulser(d,e,b)}},enemiesKilled:function(){return 0===this.enemies.length},clear:function(){this.enemies=[],this.deadEnemies=[]},setSpeed:function(a){for(var b in this.enemies)this.enemies[b].speed=a}},FX={particles:[],createParticles:function(a,b,c,d){for(var e=0;e<c;e++)this.particles.push(new Particle(a,b,d)),this.particles[this.particles.length-1].speed+=randomInt(-3,3)},update:function(){for(var a=this.particles.length;a>=0;a--)"undefined"!=typeof this.particles[a]&&(this.particles[a].kill?this.particles.splice(a,1):this.particles[a].moveToPlayer())},draw:function(a){for(var b=0;b<this.particles.length;b++)this.particles[b].draw(a)},clear:function(){this.particles=[]}};Particle.prototype={moveToPlayer:function(){this.x>Player.x-15&&this.x<Player.x+15&&this.y>Player.y-15&&this.y<Player.y+15?this.kill=!0:(this.angle=angleBetween(new Point(this.x,this.y),new Point(Player.x,Player.y)),this.x+=Math.cos(degToRad(this.angle))*this.speed,this.y+=Math.sin(degToRad(this.angle))*this.speed)},draw:function(a){a.fillStyle=this.colour,a.fillRect(this.x-this.radius/2,this.y-this.radius/2,this.radius,this.radius)}};var Sound={ctx:null,sounds:{},add:function(a,b){null!==this.ctx&&(this.sounds[a]=[],b.forEach(function(b,c){this.sounds[a].push(jsfxr(b,this.ctx))},this))},play:function(a){if(null!==this.ctx){var b=this.sounds[a],c=b.length>1?b[randomInt(0,b.length-1)]:b[0],d=this.ctx.createBufferSource();d.buffer=c,d.connect(this.ctx.destination),d.start(0)}}};"undefined"!=typeof AudioContext&&(Sound.ctx=new AudioContext),Sound.add("shoot",[[2,,.18,,,.75,,-.48,,.32,.41,.02,,,-1,,.58,,.79,,1,,,.25]]),Sound.add("damage",[[3,,.1,.75,.1423,.04,,-.3253,,,,,,,,,,,1,,,.2797,,.25],[3,,.1298,.7299,.1152,.121,.0359,-.3636,.0194,.0016,.1639,.1275,.016,.0303,.035,.0901,.1947,-.1091,.9605,-.1113,,.3222,-.0271,.25]]),Sound.add("die",[[3,,.01,.3347,.8256,.507,,-.9429,-7e-4,.1645,,.0677,-.24,-.8962,-.0062,,-.0312,-.0032,.9774,.8827,.9143,.0021,,.5]]),Sound.add("level",[[0,,.1,.58,.66,.71,,-.04,-.6,.76,1,-.48,,.2,,,.1282,-.0457,.33,-.0799,,,,.3]]),Sound.add("enemyAttack",[[1,,.18,.25,.38,.53,.1,-.4,-.02,.79,.66,.02,,,-1,,.58,,.79,,1,.61,,.25]]),Sound.add("enemyDie",[[3,.19,.1623,.3627,.26,.0661,,-.0971,,,,-.6375,.6342,,,,.2429,-.0249,1,,,,,.3],[3,.1488,.2141,.3548,.2375,.0913,,-.1366,-.0419,,.0198,-.6375,.6342,,,,.2429,-.0249,1,-.0332,,,,.3]]),Sound.add("bossSpawn",[[0,.16,.28,,.61,.43,,-.2421,-.0095,.83,.09,.36,.37,.15,.54,.02,.7042,.0568,.9978,.1092,,,.7862,.3]]),Sound.add("bossDie",[[1,,.14,.35,.68,,,.4281,-.1004,.578,-.429,.1456,.4425,.6189,-.0799,.53,.3077,,.74,.26,-.9031,.67,-.36,.3]]);Game.init();</script></body></html>